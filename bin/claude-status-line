#!/bin/bash
# Claude Code status line wrapper
# - Fixes context window size for Opus 4.5 (should be 680k, not 200k)
# - Formats model display name nicely (e.g., "Opus 4.5" instead of "claude-opus-4-5-20251101")
# - Wraps claude-powerline with capsule style

# Optional debug logging
if [[ -n "$CLAUDE_POWERLINE_DEBUG" ]]; then
  tee -a ~/.claude/status_line.log
else
  cat
fi | jq '
  # Fix context_window_size for Opus 4.5 (should be 680k, not 200k)
  if (.model.id | test("opus-4-5|opus-4.5"; "i")) then
    .context_window.context_window_size = 680000
  else
    .
  end
  |
  # Format model display name nicely
  .model.display_name |= (
    if test("claude-(opus|sonnet|haiku)-([0-9]+)-([0-9]+)") then
      capture("claude-(?<family>opus|sonnet|haiku)-(?<major>[0-9]+)-(?<minor>[0-9]+)") |
      ((.family | split("") | .[0] |= ascii_upcase | join("")) + " " + .major + "." + .minor)
    else
      .
    end
  )
' | npx -y @owloops/claude-powerline@latest --style=capsule
